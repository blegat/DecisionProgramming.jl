<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>N-Monitoring · DecisionProgramming.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="DecisionProgramming.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">DecisionProgramming.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Decision Programming</span><ul><li><a class="tocitem" href="../../decision-programming/influence-diagram/">Influence Diagram</a></li><li><a class="tocitem" href="../../decision-programming/decision-model/">Decision Model</a></li><li><a class="tocitem" href="../../decision-programming/analyzing-decision-strategies/">Analyzing Decision Strategies</a></li><li><a class="tocitem" href="../../decision-programming/computational-complexity/">Computational Complexity</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../used-car-buyer/">Used Car Buyer</a></li><li><a class="tocitem" href="../pig-breeding/">Pig Breeding</a></li><li class="is-active"><a class="tocitem" href>N-Monitoring</a><ul class="internal"><li><a class="tocitem" href="#Description"><span>Description</span></a></li><li><a class="tocitem" href="#Influence-Diagram"><span>Influence Diagram</span></a></li><li><a class="tocitem" href="#Decision-Model"><span>Decision Model</span></a></li><li><a class="tocitem" href="#Analyzing-Results"><span>Analyzing Results</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../contingent-portfolio-programming/">Contingent Portfolio Programming</a></li></ul></li><li><a class="tocitem" href="../../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>N-Monitoring</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>N-Monitoring</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/gamma-opt/DecisionProgramming.jl/blob/master/docs/src/examples/n-monitoring.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="N-Monitoring"><a class="docs-heading-anchor" href="#N-Monitoring">N-Monitoring</a><a id="N-Monitoring-1"></a><a class="docs-heading-anchor-permalink" href="#N-Monitoring" title="Permalink"></a></h1><h2 id="Description"><a class="docs-heading-anchor" href="#Description">Description</a><a id="Description-1"></a><a class="docs-heading-anchor-permalink" href="#Description" title="Permalink"></a></h2><p>The <span>$N$</span>-monitoring problem is described in <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>, sections 4.1 and 6.1.</p><h2 id="Influence-Diagram"><a class="docs-heading-anchor" href="#Influence-Diagram">Influence Diagram</a><a id="Influence-Diagram-1"></a><a class="docs-heading-anchor-permalink" href="#Influence-Diagram" title="Permalink"></a></h2><p><img src="../figures/n-monitoring.svg" alt/></p><p>The influence diagram of generalized <span>$N$</span>-monitoring problem where <span>$N≥1$</span> and indices <span>$k=1,...,N.$</span> The nodes are associated with states as follows. <strong>Load state</strong> <span>$L=\{high, low\}$</span> denotes the load on a structure, <strong>report states</strong> <span>$R_k=\{high, low\}$</span> report the load state to the <strong>action states</strong> <span>$A_k=\{yes, no\}$</span> which represent different decisions to fortify the structure. The <strong>failure state</strong> <span>$F=\{failure, success\}$</span> represents whether or not the (fortified) structure fails under the load <span>$L$</span>. Finally, the utility at target <span>$T$</span> depends on the whether <span>$F$</span> fails and the fortification costs.</p><p>We draw the cost of fortification <span>$c_k∼U(0,1)$</span> from a uniform distribution, and the magnitude of fortification is directly proportional to the cost. Fortification is defined as</p><div>\[f(A_k=yes) = c_k\]</div><div>\[f(A_k=no) = 0\]</div><pre><code class="language-julia">using Logging, Random
using JuMP, Gurobi
using DecisionProgramming

Random.seed!(13)

const N = 4
const L = [1]
const R_k = [k + 1 for k in 1:N]
const A_k = [(N + 1) + k for k in 1:N]
const F = [2*N + 2]
const T = [2*N + 3]
const L_states = [&quot;high&quot;, &quot;low&quot;]
const R_k_states = [&quot;high&quot;, &quot;low&quot;]
const A_k_states = [&quot;yes&quot;, &quot;no&quot;]
const F_states = [&quot;failure&quot;, &quot;success&quot;]
const c_k = rand(N)
const b = 0.03
fortification(k, a) = [c_k[k], 0][a]

S = States([
    (length(L_states), L),
    (length(R_k_states), R_k),
    (length(A_k_states), A_k),
    (length(F_states), F)
])
C = Vector{ChanceNode}()
D = Vector{DecisionNode}()
V = Vector{ValueNode}()
X = Vector{Probabilities}()
Y = Vector{Consequences}()</code></pre><h3 id="Load-State-Probability"><a class="docs-heading-anchor" href="#Load-State-Probability">Load State Probability</a><a id="Load-State-Probability-1"></a><a class="docs-heading-anchor-permalink" href="#Load-State-Probability" title="Permalink"></a></h3><p>The probability that the load is high, <span>$ℙ(L=high)$</span>, is drawn from a uniform distribution.</p><div>\[ℙ(L=high)∼U(0,1)\]</div><pre><code class="language-julia">for j in L
    I_j = Vector{Node}()
    X_j = zeros(S[I_j]..., S[j])
    X_j[1] = rand()
    X_j[2] = 1.0 - X_j[1]
    push!(C, ChanceNode(j, I_j))
    push!(X, Probabilities(j, X_j))
end</code></pre><h3 id="Reporting-Probability"><a class="docs-heading-anchor" href="#Reporting-Probability">Reporting Probability</a><a id="Reporting-Probability-1"></a><a class="docs-heading-anchor-permalink" href="#Reporting-Probability" title="Permalink"></a></h3><p>The probabilities of the report states correspond to the load state. We draw the values <span>$x∼U(0,1)$</span> and <span>$y∼U(0,1)$</span> from uniform distribution.</p><div>\[ℙ(R_k=high∣L=high)=\max\{x,1-x\}\]</div><div>\[ℙ(R_k=low∣L=low)=\max\{y,1-y\}\]</div><p>The probability of a correct report is thus in the range [0.5,1]. (This reflects the fact that a probability under 50% would not even make sense, since we would notice that if the test suggests a high load, the load is more likely to be low, resulting in that a low report &quot;turns into&quot; a high report and vice versa.)</p><pre><code class="language-julia">for j in R_k
    I_j = L
    x, y = rand(2)
    X_j = zeros(S[I_j]..., S[j])
    X_j[1, 1] = max(x, 1-x)
    X_j[1, 2] = 1.0 - X_j[1, 1]
    X_j[2, 2] = max(y, 1-y)
    X_j[2, 1] = 1.0 - X_j[2, 2]
    push!(C, ChanceNode(j, I_j))
    push!(X, Probabilities(j, X_j))
end</code></pre><h3 id="Decision-to-Fortify"><a class="docs-heading-anchor" href="#Decision-to-Fortify">Decision to Fortify</a><a id="Decision-to-Fortify-1"></a><a class="docs-heading-anchor-permalink" href="#Decision-to-Fortify" title="Permalink"></a></h3><p>Only the corresponding load report is known when making the fortification decision, thus <span>$I(A_k)=R_k$</span>.</p><pre><code class="language-julia">for (i, j) in zip(R_k, A_k)
    I_j = [i]
    push!(D, DecisionNode(j, I_j))
end</code></pre><h3 id="Probability-of-Failure"><a class="docs-heading-anchor" href="#Probability-of-Failure">Probability of Failure</a><a id="Probability-of-Failure-1"></a><a class="docs-heading-anchor-permalink" href="#Probability-of-Failure" title="Permalink"></a></h3><p>The probabilities of failure which are decresead by fortifications. We draw the values <span>$x∼U(0,1)$</span> and <span>$y∼U(0,1)$</span> from uniform distribution.</p><div>\[ℙ(F=failure∣A_N,...,A_1,L=high)=\frac{\max{\{x, 1-x\}}}{\exp{(b ∑_{k=1,...,N} f(A_k))}}\]</div><div>\[ℙ(F=failure∣A_N,...,A_1,L=low)=\frac{\min{\{y, 1-y\}}}{\exp{(b ∑_{k=1,...,N} f(A_k))}}\]</div><pre><code class="language-julia">for j in F
    I_j = L ∪ A_k
    x, y = rand(2)
    X_j = zeros(S[I_j]..., S[j])
    for s in paths(S[A_k])
        d = exp(b * sum(fortification(k, a) for (k, a) in enumerate(s)))
        X_j[1, s..., 1] = max(x, 1-x) / d
        X_j[1, s..., 2] = 1.0 - X_j[1, s..., 1]
        X_j[2, s..., 1] = min(y, 1-y) / d
        X_j[2, s..., 2] = 1.0 - X_j[2, s..., 1]
    end
    push!(C, ChanceNode(j, I_j))
    push!(X, Probabilities(j, X_j))
end</code></pre><h3 id="Consequences"><a class="docs-heading-anchor" href="#Consequences">Consequences</a><a id="Consequences-1"></a><a class="docs-heading-anchor-permalink" href="#Consequences" title="Permalink"></a></h3><p>Utility from consequences at target <span>$T$</span> from failure state <span>$F$</span></p><div>\[g(F=failure) = 0\]</div><div>\[g(F=success) = 100\]</div><p>Utility from consequences at target <span>$T$</span> from action states <span>$A_k$</span> is</p><div>\[f(A_k=yes) = c_k\]</div><div>\[f(A_k=no) = 0\]</div><p>Total cost</p><div>\[Y(F, A_N, ..., A_1) = g(F) + (-f(A_N)) + ... + (-f(A_1))\]</div><pre><code class="language-julia">for j in T
    I_j = A_k ∪ F
    Y_j = zeros(S[I_j]...)
    for s in paths(S[A_k])
        cost = sum(-fortification(k, a) for (k, a) in enumerate(s))
        Y_j[s..., 1] = cost + 0
        Y_j[s..., 2] = cost + 100
    end
    push!(V, ValueNode(j, I_j))
    push!(Y, Consequences(j, Y_j))
end</code></pre><h3 id="Validating-Influence-Diagram"><a class="docs-heading-anchor" href="#Validating-Influence-Diagram">Validating Influence Diagram</a><a id="Validating-Influence-Diagram-1"></a><a class="docs-heading-anchor-permalink" href="#Validating-Influence-Diagram" title="Permalink"></a></h3><p>Finally, we need to validate the influence diagram and sort the nodes, probabilities and consequences in increasing order by the node indices.</p><pre><code class="language-julia">validate_influence_diagram(S, C, D, V)
sort!.((C, D, V, X, Y), by = x -&gt; x.j)</code></pre><p>We define the path probability.</p><pre><code class="language-julia">P = DefaultPathProbability(C, X)</code></pre><p>As the path utility, we use the default, which is the sum of the consequences given the path.</p><pre><code class="language-julia">U = DefaultPathUtility(V, Y)</code></pre><h2 id="Decision-Model"><a class="docs-heading-anchor" href="#Decision-Model">Decision Model</a><a id="Decision-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Decision-Model" title="Permalink"></a></h2><p>An affine transformation is applied to the path utility, making all utilities positive. See <a href="../../decision-programming/decision-model/">section</a> on positive path utilities for details.</p><pre><code class="language-julia">U⁺ = PositivePathUtility(S, U)
model = Model()
z = decision_variables(model, S, D)
π_s = path_probability_variables(model, z, S, D, P; hard_lower_bound=false)</code></pre><p>Two <a href="../../decision-programming/decision-model/">lazy constraints</a> are also used to speed up the solution process.</p><pre><code class="language-julia">probability_cut(model, π_s, P)
active_paths_cut(model, π_s, S, P)</code></pre><p>The expected utility is used as the objective and the problem is solved using Gurobi.</p><pre><code class="language-julia">EV = expected_value(model, π_s, U⁺)
@objective(model, Max, EV)

optimizer = optimizer_with_attributes(
    () -&gt; Gurobi.Optimizer(Gurobi.Env()),
    &quot;IntFeasTol&quot;      =&gt; 1e-9,
    &quot;LazyConstraints&quot; =&gt; 1,
)
set_optimizer(model, optimizer)
optimize!(model)</code></pre><h2 id="Analyzing-Results"><a class="docs-heading-anchor" href="#Analyzing-Results">Analyzing Results</a><a id="Analyzing-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Analyzing-Results" title="Permalink"></a></h2><p>The decision strategy shows us that the optimal strategy is to make all four fortifications regardless of the reports (state 1 in fortification nodes corresponds to the option &quot;yes&quot;).</p><pre><code class="language-julia">Z = DecisionStrategy(z, D)</code></pre><pre><code class="language-julia-repl">julia&gt; print_decision_strategy(S, Z)
┌────────┬──────┬───┐
│  Nodes │ (2,) │ 6 │
├────────┼──────┼───┤
│ States │ (1,) │ 1 │
│ States │ (2,) │ 1 │
└────────┴──────┴───┘
┌────────┬──────┬───┐
│  Nodes │ (3,) │ 7 │
├────────┼──────┼───┤
│ States │ (1,) │ 1 │
│ States │ (2,) │ 1 │
└────────┴──────┴───┘
┌────────┬──────┬───┐
│  Nodes │ (4,) │ 8 │
├────────┼──────┼───┤
│ States │ (1,) │ 1 │
│ States │ (2,) │ 1 │
└────────┴──────┴───┘
┌────────┬──────┬───┐
│  Nodes │ (5,) │ 9 │
├────────┼──────┼───┤
│ States │ (1,) │ 1 │
│ States │ (2,) │ 1 │
└────────┴──────┴───┘</code></pre><p>The state probabilities for the strategy <span>$Z$</span> can also be obtained. These tell the probability of each state in each node, given the strategy <span>$Z$</span>.</p><pre><code class="language-julia">sprobs = StateProbabilities(S, P, Z)</code></pre><pre><code class="language-julia-repl">julia&gt; print_state_probabilities(sprobs, L)
┌───────┬──────────┬──────────┬─────────────┐
│  Node │  State 1 │  State 2 │ Fixed state │
│ Int64 │  Float64 │  Float64 │      String │
├───────┼──────────┼──────────┼─────────────┤
│     1 │ 0.564449 │ 0.435551 │             │
└───────┴──────────┴──────────┴─────────────┘
julia&gt; print_state_probabilities(sprobs, R_k)
┌───────┬──────────┬──────────┬─────────────┐
│  Node │  State 1 │  State 2 │ Fixed state │
│ Int64 │  Float64 │  Float64 │      String │
├───────┼──────────┼──────────┼─────────────┤
│     2 │ 0.515575 │ 0.484425 │             │
│     3 │ 0.442444 │ 0.557556 │             │
│     4 │ 0.543724 │ 0.456276 │             │
│     5 │ 0.552515 │ 0.447485 │             │
└───────┴──────────┴──────────┴─────────────┘
julia&gt; print_state_probabilities(sprobs, A_k)
┌───────┬──────────┬──────────┬─────────────┐
│  Node │  State 1 │  State 2 │ Fixed state │
│ Int64 │  Float64 │  Float64 │      String │
├───────┼──────────┼──────────┼─────────────┤
│     6 │ 1.000000 │ 0.000000 │             │
│     7 │ 1.000000 │ 0.000000 │             │
│     8 │ 1.000000 │ 0.000000 │             │
│     9 │ 1.000000 │ 0.000000 │             │
└───────┴──────────┴──────────┴─────────────┘
julia&gt; print_state_probabilities(sprobs, F)
┌───────┬──────────┬──────────┬─────────────┐
│  Node │  State 1 │  State 2 │ Fixed state │
│ Int64 │  Float64 │  Float64 │      String │
├───────┼──────────┼──────────┼─────────────┤
│    10 │ 0.038697 │ 0.961303 │             │
└───────┴──────────┴──────────┴─────────────┘</code></pre><p>We can also print the utility distribution for the optimal strategy and some basic statistics for the distribution.</p><pre><code class="language-julia">udist = UtilityDistribution(S, P, U, Z)</code></pre><pre><code class="language-julia-repl">julia&gt; print_utility_distribution(udist)
┌───────────┬─────────────┐
│   Utility │ Probability │
│   Float64 │     Float64 │
├───────────┼─────────────┤
│ -2.881344 │    0.038697 │
│ 97.118656 │    0.961303 │
└───────────┴─────────────┘</code></pre><pre><code class="language-julia-repl">julia&gt; print_statistics(udist)
┌──────────┬────────────┐
│     Name │ Statistics │
│   String │    Float64 │
├──────────┼────────────┤
│     Mean │  93.248950 │
│      Std │  19.287197 │
│ Skewness │  -4.783515 │
│ Kurtosis │  20.882012 │
└──────────┴────────────┘</code></pre><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Salo, A., Andelmin, J., &amp; Oliveira, F. (2019). Decision Programming for Multi-Stage Optimization under Uncertainty, 1–35. Retrieved from <a href="http://arxiv.org/abs/1910.09196">http://arxiv.org/abs/1910.09196</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../pig-breeding/">« Pig Breeding</a><a class="docs-footer-nextpage" href="../contingent-portfolio-programming/">Contingent Portfolio Programming »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 23 October 2020 06:28">Friday 23 October 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
